{"version":3,"sources":["BaseManager.js"],"names":["BaseManager","cc","Class","statics","getPath","dirs","dir","name","path","value","getData","data","datas","newData","object","refCount","resetData","getObject","obj","addRefCount","subRefCount","getRefCount","removeIndex","releaseObject","deps","loader","getDependsRecursively","release","releaseOne","config","bReleased","force","releaseDir","key"],"mappings":"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","file":"BaseManager.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\framework\\manager","sourcesContent":["\r\nlet BaseManager = cc.Class({\r\n     \r\n    statics: {\r\n\r\n        getPath: function (dirs, dir, name) {\r\n            let path = null;\r\n            let value = dirs[dir];\r\n            if (value && !!value.path) {\r\n                path = value.path + name;\r\n            }\r\n            return path;\r\n        },\r\n\r\n        getData: function (dirs, dir, name) {\r\n            let data = null;\r\n            let value = dirs[dir];\r\n            if (value && !!value.datas && value.datas[name]) {\r\n                data = value.datas[name];\r\n            }\r\n            return data;\r\n        },\r\n\r\n        newData(object, refCount) {\r\n            return { object, refCount };\r\n        },\r\n\r\n        resetData(data) {\r\n            if (!!data) {\r\n                data.object = null;\r\n                data.refCount = 0;\r\n            }\r\n        },\r\n\r\n        getObject(data) {\r\n            let obj = null;\r\n            if (!!data && !!data.object) {\r\n                obj = data.object;\r\n            }\r\n            return obj;\r\n        },\r\n\r\n        addRefCount(data) {\r\n            if (!!data) {\r\n                data.refCount++;\r\n            }\r\n        },\r\n\r\n        subRefCount(data) {\r\n            if (!!data) {\r\n                data.refCount--;\r\n            }\r\n        },\r\n\r\n        getRefCount(data) {\r\n            return data.refCount;\r\n        },\r\n\r\n        // 删除一个缓存索引\r\n        removeIndex: function (dirs, dir, name) {\r\n            let value = dirs[dir];\r\n            if (value && !!value.datas && value.datas[name]) {\r\n                delete value.datas[name];\r\n            }\r\n        },\r\n\r\n        // 释放实际资源\r\n        releaseObject(object) {\r\n            if (!!object) {\r\n                let deps = cc.loader.getDependsRecursively(object);\r\n                if (deps) {\r\n                    cc.loader.release(deps); \r\n                }\r\n            }\r\n        },\r\n\r\n        // 释放一项资源\r\n        releaseOne: function (dirs, dir, name, config) {\r\n            let bReleased = false;\r\n            let data = this.getData(dirs, dir, name);\r\n            if (data) {\r\n                this.subRefCount(data);\r\n                if (data.refCount <= 0 || (!!config && config.force === true)) {\r\n                    this.removeIndex(dirs, dir, name); // 删除资源的缓存索引\r\n                    this.releaseObject(data.object);\r\n                    // log.info('BaseManager.release: dir={}, name={}', dir, name);\r\n                    this.resetData(data);\r\n                    bReleased = true; \r\n                }\r\n            }\r\n            return bReleased;\r\n        },\r\n\r\n        // 释放整个目录下的资源(包括索引缓存和实际资源)\r\n        releaseDir: function (dirs, dir) {\r\n            let value = dirs[dir];\r\n            if (value && !!value.datas) {\r\n                for (let key in value.datas) {\r\n                    this.releaseOne(dirs, dir, key, { force:true });\r\n                }\r\n                value.datas = {};\r\n            }\r\n        },\r\n    },\r\n\r\n});"]}