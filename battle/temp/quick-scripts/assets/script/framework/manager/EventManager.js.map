{"version":3,"sources":["EventManager.js"],"names":["window","game","EventManager","eventTarget","referenceMap","init","cc","EventTarget","on","event","callback","target","autoTargetOff","once","off","targetOff","self","Component","onDestroy","func","log","info","name","call","dispatchEvent","type","data","eventObj","Event","EventCustom","get","put"],"mappings":";;;;;;AAEA;AACAA,OAAOC,IAAP,KAAgBD,OAAOC,IAAP,GAAc,EAA9B;;AAEAA,KAAKC,YAAL,GAAoB;AAChBC,iBAAa,IADG;AAEhBC,kBAAc,EAFE;AAGhBC,UAAM,gBAAY;AACd,YAAI,CAAC,KAAKF,WAAV,EAAuB;AACnB,iBAAKA,WAAL,GAAmB,IAAIG,GAAGC,WAAP,EAAnB;AACH;AACJ,KAPe;;AAShBC,QAAI,YAAUC,KAAV,EAAiBC,QAAjB,EAA2BC,MAA3B,EAAmC;AACnC,YAAG,CAACF,KAAJ,EAAU;AACN;AACH;AACD,aAAKJ,IAAL;AACA,aAAKF,WAAL,CAAiBK,EAAjB,CAAoBC,KAApB,EAA2BC,QAA3B,EAAqCC,MAArC;AACA,aAAKC,aAAL,CAAmBD,MAAnB;;AAEA,YAAI,CAAC,KAAKP,YAAL,CAAkBK,KAAlB,CAAL,EAA+B,KAAKL,YAAL,CAAkBK,KAAlB,IAA2B,CAA3B;AAClC,KAlBe;;AAoBhBI,UAAM,cAAUJ,KAAV,EAAiBC,QAAjB,EAA2BC,MAA3B,EAAmC;AACrC,aAAKN,IAAL;AACA,aAAKF,WAAL,CAAiBU,IAAjB,CAAsBJ,KAAtB,EAA6BC,QAA7B,EAAuCC,MAAvC;AACH,KAvBe;;AAyBhBG,SAAK,aAAUL,KAAV,EAAiBC,QAAjB,EAA2BC,MAA3B,EAAmC;AACpC,aAAKN,IAAL;AACA,aAAKF,WAAL,CAAiBW,GAAjB,CAAqBL,KAArB,EAA4BC,QAA5B,EAAsCC,MAAtC;AACH,KA5Be;;AA8BhBI,eAAW,mBAAUJ,MAAV,EAAkB;AACzB,aAAKN,IAAL;AACA,aAAKF,WAAL,CAAiBY,SAAjB,CAA2BJ,MAA3B;AACH,KAjCe;;AAmChB;AACAC,mBAAe,uBAAUD,MAAV,EAAkB;AAC7B,YAAIK,OAAO,IAAX;AACA,YAAIL,kBAAkBL,GAAGW,SAAzB,EAAoC;AAChC;AACA,gBAAI,CAAC,CAACN,OAAOO,SAAb,EAAwB;AACpB,oBAAIC,OAAOR,OAAOO,SAAlB;AACAP,uBAAOO,SAAP,GAAmB,YAAY;AAC3BE,wBAAIC,IAAJ,CAAS,4CAAT,EAAuDV,OAAOW,IAA9D;AACAN,yBAAKD,SAAL,CAAeJ,MAAf;AACAQ,yBAAKI,IAAL,CAAUZ,MAAV;AACH,iBAJD;AAKH,aAPD,MAOO;AACHA,uBAAOO,SAAP,GAAmB,YAAY;AAC3BE,wBAAIC,IAAJ,CAAS,gCAAT,EAA2CV,OAAOW,IAAlD;AACAN,yBAAKD,SAAL,CAAeJ,MAAf;AACH,iBAHD;AAIH;AACJ;AACJ,KAtDe;;AAwDhBa,mBAAe,uBAAUC,IAAV,EAAgBC,IAAhB,EAAsB;AACjC,aAAKrB,IAAL;AACA;AACA,YAAIsB,WAAWrB,GAAGsB,KAAH,CAASC,WAAT,CAAqBC,GAArB,CAAyBL,IAAzB,CAAf;AACAE,iBAASD,IAAT,GAAgBA,IAAhB;AACA,aAAKvB,WAAL,CAAiBqB,aAAjB,CAA+BG,QAA/B;AACA,eAAOA,SAASD,IAAhB;AACApB,WAAGsB,KAAH,CAASC,WAAT,CAAqBE,GAArB,CAAyBJ,QAAzB;AACH;AAhEe,CAApB","file":"EventManager.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\framework\\manager","sourcesContent":["\r\n\r\n//事件管理类\r\nwindow.game || (window.game = {});\r\n\r\ngame.EventManager = {\r\n    eventTarget: null,\r\n    referenceMap: {},\r\n    init: function () {\r\n        if (!this.eventTarget) {\r\n            this.eventTarget = new cc.EventTarget();\r\n        }\r\n    },\r\n\r\n    on: function (event, callback, target) {\r\n        if(!event){\r\n            return;\r\n        }\r\n        this.init();\r\n        this.eventTarget.on(event, callback, target);\r\n        this.autoTargetOff(target);\r\n\r\n        if (!this.referenceMap[event]) this.referenceMap[event] = 1;\r\n    },\r\n\r\n    once: function (event, callback, target) {\r\n        this.init();\r\n        this.eventTarget.once(event, callback, target);\r\n    },\r\n\r\n    off: function (event, callback, target) {\r\n        this.init();\r\n        this.eventTarget.off(event, callback, target);\r\n    },\r\n\r\n    targetOff: function (target) {\r\n        this.init();\r\n        this.eventTarget.targetOff(target);\r\n    },\r\n\r\n    // 自动释放监听事件\r\n    autoTargetOff: function (target) {\r\n        let self = this;\r\n        if (target instanceof cc.Component) {\r\n            // 已存在onDestroy，覆写\r\n            if (!!target.onDestroy) {\r\n                let func = target.onDestroy;\r\n                target.onDestroy = function () {\r\n                    log.info('EventManager: destroy and remove target {}', target.name);\r\n                    self.targetOff(target);\r\n                    func.call(target);\r\n                }\r\n            } else {\r\n                target.onDestroy = function () {\r\n                    log.info('EventManager: remove target {}', target.name);\r\n                    self.targetOff(target);\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    dispatchEvent: function (type, data) {\r\n        this.init();\r\n        // 从对象池取事件对象\r\n        let eventObj = cc.Event.EventCustom.get(type);\r\n        eventObj.data = data;\r\n        this.eventTarget.dispatchEvent(eventObj);\r\n        delete eventObj.data;\r\n        cc.Event.EventCustom.put(eventObj);\r\n    }\r\n}\r\n"]}