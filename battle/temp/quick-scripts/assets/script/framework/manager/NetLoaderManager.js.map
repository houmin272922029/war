{"version":3,"sources":["NetLoaderManager.js"],"names":["ResManager","require","Global","NetLoaderManager","netStatus","cc","Enum","difference","general","good","genralLevel","goodLevel","oldPrefabs","name","clockId","needCheckPrefabs","isInit","initPrefabs","key","prefabURL","item","push","i","length","startCheckStatus","url","getNetPower","arr","split","panelName","setTimeout","showUI","reconnectionView","closeCheckStatus","object","clearTimeout","netDelayTime","clear","module","exports"],"mappings":"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","file":"NetLoaderManager.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\framework\\manager","sourcesContent":["//解决GameHelper中无法引用NetHelper的问题\r\nconst ResManager = require('ResManager');\r\nconst Global = require('Global');\r\n\r\nlet NetLoaderManager = {\r\n    netStatus:cc.Enum({difference:0,general:1,good:2}),\r\n    genralLevel:250,\r\n    goodLevel:20,\r\n    oldPrefabs:[\r\n        {name:'TreasureHuntFishStartPanel',clockId:-1},\r\n        {name:'treasureHuntFishView',clockId:-1},\r\n        {name:'palaceTip',clockId:-1},\r\n        {name:'palace',clockId:-1},\r\n    ],\r\n    needCheckPrefabs:[\r\n    ],\r\n    isInit:false,\r\n    \r\n    initPrefabs: function(){\r\n        if (this.isInit) {\r\n            return;\r\n        }\r\n        for (let key in ResManager.prefabURL) {\r\n            let item = ResManager.prefabURL[key];\r\n            // let url = PrefabManager.fullPath(item.dir, item.name);\r\n            // let arr = url.split('/');\r\n            // let panelName = arr[arr.length - 1];\r\n            this.needCheckPrefabs.push({name:item.name,clockId:-1});\r\n        }\r\n\r\n        for (let i = 0; i < this.oldPrefabs.length; i++) {\r\n            this.needCheckPrefabs.push(this.oldPrefabs[i]);\r\n        }\r\n        this.isInit = true;\r\n    },\r\n\r\n    //网络延迟大的情况下，提示玩家网络状态不好\r\n    startCheckStatus: function(url) {\r\n        //网络状态不佳的时开启检查\r\n        if (this.getNetPower() === this.netStatus.difference) {\r\n            if (!!url) {\r\n                let arr = url.split('/');\r\n                let panelName = arr[arr.length - 1];\r\n                if(!!panelName) {\r\n                    for (let i = 0; i < this.needCheckPrefabs.length;i++) {\r\n                        if (panelName === this.needCheckPrefabs[i].name && this.needCheckPrefabs[i].clockId < 0) {\r\n                            this.needCheckPrefabs[i].clockId = setTimeout(() => {\r\n                                // Global.CommomUICtl.initCreateTips({tip: \"当前网络状态不佳!\", time: 2});\r\n                                require('UIManager').showUI(ResManager.prefabURL.reconnectionView,1);\r\n                                this.needCheckPrefabs[i].clockId = -1;\r\n                            }, 4000);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    //关闭网络延迟提示\r\n    closeCheckStatus: function(object){\r\n        if (!object) {\r\n            return;\r\n        }\r\n        let name = object.name;\r\n        if(!!name) {\r\n            for (let i = 0; i < this.needCheckPrefabs.length;i++) {\r\n                if (name === this.needCheckPrefabs[i].name) {\r\n                    if (this.needCheckPrefabs[i].clockId >= 0) {\r\n                        clearTimeout(this.needCheckPrefabs[i].clockId);\r\n                        \r\n                        this.needCheckPrefabs[i].clockId = -1;\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    getNetPower: function(){\r\n        if (Global.netDelayTime <= this.goodLevel ) {\r\n            return this.netStatus.good;\r\n        }else if (Global.netDelayTime <= this.genralLevel) {\r\n            return this.netStatus.general;\r\n        }else {\r\n            return this.netStatus.difference;\r\n        }\r\n        return this.netStatus.general;\r\n\r\n    },\r\n\r\n    clear: function(){\r\n        for (let i = 0; i < this.needCheckPrefabs.length; i++) {\r\n            if (this.needCheckPrefabs[i].clockId > -1) {\r\n                clearTimeout(this.needCheckPrefabs[i].clockId);\r\n                this.needCheckPrefabs[i].clockId = -1;\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n};\r\nmodule.exports = NetLoaderManager;"]}