{"version":3,"sources":["ViewManager.js"],"names":["AudioManager","require","UIManager","ResLoadManager","Global","PrefabManager","AnimManager","SpineManager","SpriteManager","ViewManager","prevScene","nextScene","currentScene","name","instance","SceneInfo","Login","comName","JumpScene","LoadingScene","Hall","MainScene","preload","type","Type","Welcome","dir","MainBg","Spine","Fish","delay","BgLayer","path","layer","BaseLayer","PlayerLayer","UILayer","PopupLayer","GameLayer","BulletLayer","WeaponLayer","FishLayer","ZhaoHuanLayer","CoinLayer","SuperWeaponLayer","SkillLayer","ArenaLayer","SwitchBtn","loadScene","sceneInfo","data","_setPreScene","init","opportunity","enterScene","log","info","cc","director","err","scene","error","reset","releaseOldScene","setCurrentScene","releaseScene","isMainScene","releaseDir","resetLayersFromMainScene","sys","garbageCollect","node","getChildByName","getComponent","getCurrentScene","isCurrentScene","isArenaScene","getScene","getCanvas","getNodeFromMainScene","layerInfo","find","getLayerFromMainScene","getUILayerFromScene","isValid","layerNode","Node","setContentSize","parent","getPopLayerFromScene","canvas","showUI","config","prefab","_name","ret","createUI","ui","inHiding","stopAllActions","active","undefined","action","game","Types","ActionType","Default","opacity","Fade","func","callFunc","runAction","fadeIn","sequence","delayTime","Jump","scale","scaleTo","hideUI","remove","getUIInstance","uuid","root","removeUI","end","nextBgMusic","playMusic","bind","fadeOut","module","exports"],"mappings":"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","file":"ViewManager.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\framework\\manager","sourcesContent":["const AudioManager = require('AudioManager');\r\nconst UIManager = require('UIManager');\r\nconst ResLoadManager = require('ResLoadManager');\r\nconst Global = require('Global');\r\nconst PrefabManager = require('PrefabManager');\r\nconst AnimManager = require('AnimManager');\r\nconst SpineManager = require('SpineManager');\r\nconst SpriteManager = require('SpriteManager');\r\n\r\nlet ViewManager = {\r\n\r\n    prevScene: null, // 上一场景\r\n    nextScene: null, // 下一场景\r\n\r\n    // 当前场景数据 \r\n    // name:场景名称, instance:场景对象实例(通过instance.node可得到场景节点)\r\n    currentScene: { name: '', instance: null },\r\n\r\n    // 游戏中所有场景的文件名和脚本名\r\n    // preload: 定义本场景内需预加载的资源，以目录为单位，暂不支持单个文件\r\n    SceneInfo: {\r\n        Login: { name: \"login\", comName: 'Login' },\r\n        JumpScene: { name: \"jumpScene\", comName: 'JumpScene' },\r\n        LoadingScene: { name: \"loadingScene\", comName: 'LoadingScene' },\r\n        // 大厅\r\n        Hall: { name: \"hall\", comName: 'Hall' },\r\n        // 主渔场\r\n        MainScene: {\r\n            name: \"mainScene\", comName: 'MainScene',\r\n            preload: [\r\n                { type: ResLoadManager.Type.Welcome, dir: 'welcome' },\r\n                { type: ResLoadManager.Type.MainBg, dir: 'mainBg' },\r\n                { type: ResLoadManager.Type.Spine, dir: 'boss' },\r\n                { type: ResLoadManager.Type.Fish, dir: 'fish', delay: 100 }\r\n            ],\r\n        },\r\n    },\r\n\r\n    // 主渔场的子节点\r\n    MainScene: {\r\n        // path:节点路径(可以有层级)，comName:节点对象实例名(脚本组件名)，layer:实例对象缓存\r\n        // 第1层\r\n        BgLayer: { path: 'bgLayer', comName: 'BgLayer', layer: null }, // 背景层\r\n        BaseLayer: { path: 'baseLayer', comName: 'BaseLayer', layer: null }, // 基础视图层(鱼、子弹、渔网)\r\n        PlayerLayer: { path: 'playerLayer', comName: 'PlayerLayer', layer: null }, // 玩家层(UI按钮、炮台、金币特效)\r\n        UILayer: { path: 'uiLayer', comName: 'UILayer', layer: null }, // UI层(各个UI面板)\r\n        PopupLayer: { path: 'popupLayer', comName: 'PopupLayer', layer: null }, // 弹窗层(各种弹窗)\r\n        GameLayer: { path: 'gameLayer', comName: 'GameLayer', layer: null }, //小游戏层\r\n        // FishLayer: { path: 'bgLayer', comName: 'FishLayer', layer: null }, //鱼的游动层\r\n        // 第2层\r\n        BulletLayer: { path: 'baseLayer/bulletLayer', comName: 'BulletLayer', layer: null }, // 子弹层\r\n        WeaponLayer: { path: 'playerLayer/weaponLayer', comName: 'WeaponLayer', layer: null }, // 炮台\r\n        FishLayer: { path: 'baseLayer/fishLayer', comName: 'FishLayer', layer: null }, //渔场层\r\n        ZhaoHuanLayer: { path: 'playerLayer/zhaoHuanLayer', comName: 'zhaoHuanLayer', layer: null }, //召唤层级\r\n        CoinLayer: { path: 'playerLayer/coinLayer', comName: 'CoinEffectLayer', layer: null }, // 特效层\r\n        SuperWeaponLayer: { path: 'playerLayer/superWeaponLayer', comName: 'SuperWeaponLayer', layer: null }, //轰炸机特效层\r\n        SkillLayer: { path: 'playerLayer/skillLayer', comName: 'SkillLayer', layer: null }, // 技能按钮层\r\n        ArenaLayer: { path: 'playerLayer/arenaLayer', comName: 'ArenaLayer', layer: null }, //竞技场\r\n        SwitchBtn: { path: 'playerLayer/switchBtn', comName: 'SwitchBtn', layer: null }   //左右适配的按钮\r\n    },\r\n\r\n    /**\r\n     * 切换场景\r\n     * @param {*场景数据} sceneInfo \r\n     * @param {*其它属性} data \r\n     */\r\n    loadScene: function (sceneInfo, data) {\r\n        this._setPreScene();\r\n        ResLoadManager.init(this);\r\n        this.nextScene = sceneInfo;\r\n        if (sceneInfo.name == 'hall') {\r\n            Global.opportunity = 2;// 1进入渔场、2进入大厅、3进入竞技场\r\n        }\r\n        // 先进入Loading场景\r\n        this.enterScene(this.SceneInfo.LoadingScene);\r\n    },\r\n\r\n    // 所有资源加载完毕，真正进入场景\r\n    enterScene: function (sceneInfo) {\r\n        log.info('ViewManager.enterScene: {}', sceneInfo.name);\r\n\r\n        cc.director.loadScene(sceneInfo.name, (err, scene) => {\r\n            if (err) {\r\n                log.error('ViewManager.enterScene: error to load scene: ' + err);\r\n                return;\r\n            }\r\n\r\n            UIManager.reset();\r\n            this.releaseOldScene(this.currentScene.name);\r\n            this.setCurrentScene(sceneInfo, scene);\r\n        });\r\n    },\r\n\r\n    // 释放旧场景资源\r\n    releaseOldScene: function (name) {\r\n        if (!name) {\r\n            return;\r\n        }\r\n\r\n        AnimManager.releaseScene(name);\r\n        SpineManager.releaseScene(name);\r\n        // SpriteManager.releaseScene(name);\r\n        // PrefabManager.releaseScene(name);\r\n\r\n        // 如果从主渔场退出，还需释放所有鱼资源\r\n        if (this.isMainScene(name)) {\r\n            AnimManager.releaseDir('fish');\r\n            SpineManager.releaseDir('fish');\r\n\r\n            this.resetLayersFromMainScene();\r\n        }\r\n\r\n        cc.sys.garbageCollect(); // 调用垃圾回收\r\n    },\r\n\r\n    // 切换渔场时重置layer缓存\r\n    resetLayersFromMainScene: function () {\r\n        for (let name in this.MainScene) {\r\n            if (this.MainScene[name]) {\r\n                this.MainScene[name].layer = null;\r\n            }\r\n        }\r\n    },\r\n\r\n    setCurrentScene: function (sceneInfo, scene) {\r\n        log.info('ViewManager.setCurrentScene: {}', sceneInfo.name);\r\n\r\n        // 场景节点的根节点是Canvas\r\n        let node = scene.getChildByName('Canvas');\r\n        if (node) {\r\n            this.currentScene.name = sceneInfo.name;\r\n            this.currentScene.instance = node.getComponent(sceneInfo.comName);\r\n        } else {\r\n            this.currentScene.name = '';\r\n            this.currentScene.instance = null;\r\n        }\r\n    },\r\n\r\n    getCurrentScene: function () {\r\n        return (this.currentScene.instance);\r\n    },\r\n\r\n    // 判断指定场景是否当前正在运行的场景\r\n    isCurrentScene: function (sceneInfo) {\r\n        return (this.currentScene.instance && this.currentScene.name === sceneInfo.name) ? true : false;\r\n    },\r\n\r\n    // 判断指定场景是否主渔场\r\n    isMainScene: function (name) {\r\n        return (!!name && name === this.SceneInfo.MainScene.name);\r\n    },\r\n\r\n    // 判断指定场景是否竞技场\r\n    isArenaScene: function (name) {\r\n\r\n    },\r\n\r\n    // 返回当前场景节点的对象实例\r\n    getScene: function (sceneInfo) {\r\n        let scene = null;\r\n        if (this.isCurrentScene(sceneInfo)) {\r\n            scene = this.currentScene.instance;\r\n        }\r\n        return scene;\r\n    },\r\n\r\n    //返回当前场景的canvas\r\n    getCanvas: function () {\r\n        return cc.director.getScene().getChildByName('Canvas');\r\n\r\n    },\r\n\r\n    // 根据节点路径返回主渔场内相应layer节点，如果失败返回null\r\n    getNodeFromMainScene: function (layerInfo) {\r\n        let node = null;\r\n        if (this.isCurrentScene(this.SceneInfo.MainScene)) {\r\n            node = cc.find(layerInfo.path, this.currentScene.instance.node);\r\n        }\r\n        return node;\r\n    },\r\n\r\n    // 根据节点路径返回主渔场内相应layer节点的对象实例，如果失败返回null\r\n    getLayerFromMainScene: function (layerInfo) {\r\n        if (!layerInfo) {\r\n            return null;\r\n        }\r\n        if (!layerInfo.layer) {\r\n            let node = this.getNodeFromMainScene(layerInfo);\r\n            if (node) {\r\n                layerInfo.layer = node.getComponent(layerInfo.comName);\r\n            }\r\n        }\r\n        return layerInfo.layer;\r\n    },\r\n\r\n    //获得的UI显示层 有些面板即要显示在大厅，又要显示在渔场中\r\n    getUILayerFromScene: function () {\r\n        let layer = null;\r\n        if (!!this.currentScene.instance && cc.isValid(this.currentScene.instance.node)) {\r\n            layer = cc.find(this.MainScene.UILayer.path, this.currentScene.instance.node);\r\n            if (!cc.isValid(layer)) {\r\n                let layerNode = new cc.Node('uiLayer');\r\n                layerNode.setContentSize(1280, 720);\r\n                layerNode.parent = this.currentScene.instance.node;\r\n                layer = layerNode;\r\n            }\r\n        }\r\n        return layer;\r\n    },\r\n\r\n    //获得的弹出层\r\n    getPopLayerFromScene: function () {\r\n        let layer = null;\r\n        if (!!this.currentScene.instance && cc.isValid(this.currentScene.instance.node)) {\r\n            layer = cc.find(this.MainScene.PopupLayer.path, this.currentScene.instance.node);\r\n            if (!cc.isValid(layer)) {\r\n                let layerNode = new cc.Node('popupLayer');\r\n                layerNode.setContentSize(1280, 720);\r\n                layerNode.parent = this.currentScene.instance.node;\r\n                layer = layerNode;\r\n            }\r\n        } else {\r\n            //登录界面中的弹窗\r\n            let canvas = this.getCanvas();\r\n            if (!!canvas) {\r\n                layer = canvas.getChildByName('popupLayer');\r\n                if (!cc.isValid(layer)) {\r\n                    let layerNode = new cc.Node('popupLayer');\r\n                    layerNode.setContentSize(1280, 720);\r\n                    layerNode.parent = canvas;\r\n                    layer = layerNode;\r\n                }\r\n            }\r\n\r\n        }\r\n        return layer;\r\n    },\r\n\r\n\r\n    /**\r\n     * 游戏截屏\r\n     * @param {*截屏成功回调} func \r\n     */\r\n    // screenShot: function (func) {\r\n    //     if (!cc.sys.isNative) return;\r\n    //     let dirpath = 'share.jpg';\r\n    //     let size = cc.winSize;\r\n    //     let rt = cc.RenderTexture.create(size.width, size.height, cc.Texture2D.PIXEL_FORMAT_RGBA8888, gl.DEPTH24_STENCIL8_OES);\r\n    //     cc.director.getScene()._sgNode.addChild(rt);\r\n    //     rt.setVisible(false);\r\n    //     rt.begin();\r\n    //     cc.director.getScene()._sgNode.visit();\r\n    //     rt.end();\r\n    //     jsb.fileUtils.removeFile(jsb.fileUtils.getWritablePath() + dirpath);\r\n    //     rt.saveToFile(dirpath, cc.ImageFormat.JPG, true, function (renderTexture, path) {\r\n    //         rt.destroy(true);\r\n    //         if (func) {\r\n    //             func(dirpath);\r\n    //         }\r\n    //     });\r\n    // },\r\n\r\n    /**\r\n     * 显示UI\r\n     * config = {prefab: cc.Prefab, type:ShowType, ui:cc.Node, zIndex: zIndex, action: ActionType, backPrefab: cc.Prefab}\r\n     */\r\n    showUI: function (config) {\r\n        log.info('showUI {}', config.prefab._name);\r\n        if (!config || !config.prefab) return;\r\n        // 创建ui实例,  createUI内 uid判断是否存在， 避免多次创建\r\n        let ret = UIManager.createUI(config.prefab);\r\n        let ui = ret[1];\r\n\r\n        if (!ret[0]) {\r\n            if (!ui.inHiding) {\r\n                return ui;\r\n            }\r\n            ui.stopAllActions();\r\n        }\r\n        // 处理显示父节点\r\n        // if (config.type == game.Types.ShowType.ShowByNode) {\r\n        //     ui.parent = config.ui;\r\n        // }\r\n        // if (config.type == game.Types.ShowType.ShowByLayer) {\r\n        //     ui.parent = cc.find('Canvas');\r\n        //     if (config.zIndex > 0) {\r\n        //         ui.zIndex = config.zIndex;\r\n        //     }\r\n        // }\r\n\r\n        ui.active = true;\r\n        if (!!config.parent) {\r\n            ui.parent = config.parent;\r\n        }\r\n        if (undefined === config.action) {\r\n            config.action = game.Types.ActionType.Default;\r\n        }\r\n        ui.opacity = config.action > 0 ? 0 : 255;\r\n\r\n        // 处理显示动画\r\n        // utils.keepActionFPS(0.4, 60);\r\n        if (game.Types.ActionType.Fade == config.action || game.Types.ActionType.Default == config.action) {\r\n            let func = cc.callFunc(function () {\r\n                ui.opacity = 0.2;\r\n                ui.runAction(cc.fadeIn(0.3));\r\n            });\r\n            ui.runAction(cc.sequence(cc.delayTime(0.1), func));\r\n        }\r\n        if (game.Types.ActionType.Jump == config.action) {\r\n            let func = cc.callFunc(function () {\r\n                ui.scale = 0;\r\n                ui.opacity = 255;\r\n                ui.runAction(cc.scaleTo(0.2, 1));\r\n            });\r\n            ui.runAction(cc.sequence(cc.delayTime(0.1), func));\r\n        }\r\n        // ui.emit('show', {});\r\n        return ui;\r\n    },\r\n\r\n    /**\r\n     * \r\n     * @param {*} config \r\n     * @param {*是否从UIManager中移除} remove \r\n     */\r\n    hideUI: function (config, remove) {\r\n        let node = UIManager.getUIInstance(config.uuid, true);\r\n        if (!node) {\r\n            return;\r\n        }\r\n        log.info('hideUI {}', node._name);\r\n        let root = node.root ? node.root : node;\r\n        remove || (remove = false);\r\n        if (remove) {\r\n            UIManager.removeUI(config.uuid);\r\n        }\r\n        let end = cc.callFunc(function () {\r\n            UIManager.removeUI(config.uuid);\r\n            if (config.nextBgMusic) {\r\n                AudioManager.playMusic(config.nextBgMusic);\r\n            }\r\n        }.bind(node));\r\n\r\n        if (!config.action || config.action == game.Types.ActionType.Default) {\r\n            config.action = game.Types.ActionType.Fade;\r\n        }\r\n\r\n        // utils.keepActionFPS(0.2, 60);\r\n        if (game.Types.ActionType.Jump == config.action) {\r\n            root.inHiding = true;\r\n            root.runAction(cc.sequence(cc.scaleTo(0.2, 0), end));\r\n        }\r\n        if (game.Types.ActionType.Fade == config.action) {\r\n            root.inHiding = true;\r\n            root.runAction(cc.sequence(cc.fadeOut(0.2), end));\r\n        }\r\n    },\r\n\r\n    _setPreScene: function () {\r\n        if (this.currentScene.name === 'mainScene') {\r\n            this.prevScene = { name: \"mainScene\" };\r\n        } else if (this.currentScene.name === 'hall') {\r\n            this.prevScene = { name: \"hall\" };\r\n        } else {\r\n            this.prevScene = { name: \"login\" };\r\n        }\r\n        // this.prevScene = \r\n    },\r\n\r\n}\r\n\r\nmodule.exports = ViewManager;\r\n"]}