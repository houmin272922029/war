{"version":3,"sources":["CustomMaterial.js"],"names":["renderEngine","cc","renderer","gfx","Material","CustomMaterial","Material$$1","shaderName","params","defines","call","pass","Pass","setDepth","setCullMode","CULL_NONE","setBlend","BLEND_FUNC_ADD","BLEND_SRC_ALPHA","BLEND_ONE_MINUS_SRC_ALPHA","techParams","name","type","PARAM_TEXTURE_2D","PARAM_COLOR4","concat","mainTech","Technique","_color","r","g","b","a","_effect","Effect","_mainTech","_texture","__proto__","prototype","Object","create","constructor","prototypeAccessors","effect","configurable","texture","color","get","set","val","setProperty","getImpl","_texIds","getId","clone","copy","updateHash","setParamValue","value","setDefine","define","defineProperties","module","exports"],"mappings":"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","file":"CustomMaterial.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\framework\\utils","sourcesContent":["/**\r\n * 自定义材质\r\n */\r\n\r\nconst renderEngine = cc.renderer.renderEngine;\r\nconst renderer = renderEngine.renderer;\r\nconst gfx = renderEngine.gfx;\r\nconst Material = renderEngine.Material;\r\n\r\nvar CustomMaterial = (function (Material$$1) {\r\n\tfunction CustomMaterial(shaderName, params, defines) {\r\n\t\tMaterial$$1.call(this, false);\r\n\r\n\t\tvar pass = new renderer.Pass(shaderName);\r\n\t\tpass.setDepth(false, false);\r\n\t\tpass.setCullMode(gfx.CULL_NONE);\r\n\t\tpass.setBlend(\r\n\t\t\tgfx.BLEND_FUNC_ADD,\r\n\t\t\tgfx.BLEND_SRC_ALPHA, gfx.BLEND_ONE_MINUS_SRC_ALPHA,\r\n\t\t\tgfx.BLEND_FUNC_ADD,\r\n\t\t\tgfx.BLEND_SRC_ALPHA, gfx.BLEND_ONE_MINUS_SRC_ALPHA\r\n\t\t);\r\n\r\n\t\tvar techParams = [\r\n\t\t\t{ name: 'texture', type: renderer.PARAM_TEXTURE_2D },\r\n\t\t\t{ name: 'color', type: renderer.PARAM_COLOR4 }\r\n\t\t];\r\n\t\tif (params) {\r\n\t\t\ttechParams = techParams.concat(params);\r\n\t\t}\r\n\t\tvar mainTech = new renderer.Technique(\r\n\t\t\t['transparent'],\r\n\t\t\ttechParams,\r\n\t\t\t[pass]\r\n\t\t);\r\n\r\n\t\tthis.name = shaderName;\r\n\t\tthis._color = { r: 1, g: 1, b: 1, a: 1 };\r\n\t\tthis._effect = new renderer.Effect(\r\n\t\t\t[\r\n\t\t\t\tmainTech\r\n\t\t\t],\r\n\t\t\t{},\r\n\t\t\tdefines,\r\n\t\t);\r\n\r\n\t\tthis._mainTech = mainTech;\r\n\t\tthis._texture = null;\r\n\t}\r\n\r\n\tif (Material$$1) CustomMaterial.__proto__ = Material$$1;\r\n\tCustomMaterial.prototype = Object.create(Material$$1 && Material$$1.prototype);\r\n\tCustomMaterial.prototype.constructor = CustomMaterial;\r\n\r\n\tvar prototypeAccessors = { effect: { configurable: true }, texture: { configurable: true }, color: { configurable: true } };\r\n\r\n\tprototypeAccessors.effect.get = function () {\r\n\t\treturn this._effect;\r\n\t};\r\n\r\n\tprototypeAccessors.texture.get = function () {\r\n\t\treturn this._texture;\r\n\t};\r\n\r\n\tprototypeAccessors.texture.set = function (val) {\r\n\t\tif (this._texture !== val) {\r\n\t\t\tthis._texture = val;\r\n\t\t\tthis._effect.setProperty('texture', val.getImpl());\r\n\t\t\tthis._texIds['texture'] = val.getId();\r\n\t\t}\r\n\t};\r\n\r\n\tprototypeAccessors.color.get = function () {\r\n\t\treturn this._color;\r\n\t};\r\n\r\n\tprototypeAccessors.color.set = function (val) {\r\n\t\tvar color = this._color;\r\n\t\tcolor.r = val.r / 255;\r\n\t\tcolor.g = val.g / 255;\r\n\t\tcolor.b = val.b / 255;\r\n\t\tcolor.a = val.a / 255;\r\n\t\tthis._effect.setProperty('color', color);\r\n\t};\r\n\r\n\tCustomMaterial.prototype.clone = function clone() {\r\n\t\tvar copy = new CustomMaterial();\r\n\t\tcopy.texture = this.texture;\r\n\t\tcopy.color = this.color;\r\n\t\tcopy.updateHash();\r\n\t\treturn copy;\r\n\t};\r\n\r\n\t// 设置自定义参数的值\r\n\tCustomMaterial.prototype.setParamValue = function (name, value) {\r\n\t\tthis._effect.setProperty(name, value);\r\n\t};\r\n\r\n\t// 设置定义值\r\n\tCustomMaterial.prototype.setDefine = function (name, value) {\r\n\t\tthis._effect.define(name, value);\r\n\t};\r\n\r\n\tObject.defineProperties(CustomMaterial.prototype, prototypeAccessors);\r\n\r\n\treturn CustomMaterial;\r\n}(Material));\r\n\r\nmodule.exports = CustomMaterial;"]}