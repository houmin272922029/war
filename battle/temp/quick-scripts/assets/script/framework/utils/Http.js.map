{"version":3,"sources":["Http.js"],"names":["Global","require","Alert","il8n","CodeType","Base64","md5","Http","sendRequest","path","data","handler","extraUrl","str","k","url","requestURL","sendXHR","responseText","status","ret","JSON","parse","responseHandler","log","info","indexOf","xhr","cc","loader","getXMLHttpRequest","onreadystatechange","readyState","error","open","sys","isNative","setRequestHeader","timeout","send","operType","testcard","type","time","itemUse","checkin","shop","itemBuy","itemSend","mailGA","bless","search","role","mailLS","mailCG","red","notice","shopdh","itemSell","share","shareBonus","midas","playerDataType","gold","items","dmd","vExp","vLvl","cpn","shopbuy","tryMax","tryCount","httpDelay","httpSync","callBack","self","sendData","MsgMacroHttp","sync","game","EventManager","dispatchEvent","eventName","redPointStatus","call","bind","httpJoinRoom","callback","roomType","gameType","isEnterFish","Fish","ip","show","t","httpQuick","obj","httpCode","httpOper","param","fcallBack","Date","now","oper","Math","floor","standSunTime","jsonParam","stringify","b64","encode","encodeURIComponent","sign","gentoken","success","rewardString","split","rewardNum","aftershop","updatePlayerData","code","CommomUICtl","initCreateTips","tip","roleId","token","key","refreshHall","cancleFacaijin","setTimeout","refreshMainSceneRes","module","exports"],"mappings":"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","file":"Http.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\framework\\utils","sourcesContent":["\r\nconst Global = require('Global');\r\n// const PlayerData = require('PlayerData');\r\nconst Alert = require('Alert');\r\nconst il8n = require('LanguageData');\r\nconst CodeType = require('CodeType');\r\nconst Base64 = require('Base64');\r\nconst md5 = require('md5');\r\n/**\r\n * Http消息类\r\n * 用途：向服务器发送Http请求\r\n */\r\nlet Http = {\r\n\r\n    //发送请求(http请求，只用于用户登录)\r\n    sendRequest: function (path, data, handler, extraUrl) {\r\n        let str = \"?\";\r\n        for (let k in data) {\r\n            if (str != \"?\") {\r\n                str += \"&\";\r\n            }\r\n            str += k + \"=\" + data[k];\r\n        }\r\n        if (extraUrl == null) {\r\n            extraUrl = Global.url + '/';\r\n        }\r\n        let requestURL = extraUrl + path + str;\r\n        return this.sendXHR(requestURL, (responseText, status) => {\r\n            let ret = null;\r\n            if (responseText) {\r\n                ret = JSON.parse(responseText);\r\n            }\r\n            if (handler) {\r\n                handler(status, ret);\r\n            }\r\n        });\r\n    },\r\n\r\n    // 向远程发送一个http请求\r\n    // url - 输入，请求地址\r\n    // responseHandler - 输入，回调上层的函数\r\n    sendXHR: function (url, responseHandler) {\r\n        log.info('Http.sendXHR: url=' + url);\r\n        //test_bug\r\n        if(url.indexOf(\"broke\") != -1 ) {\r\n            log.info(\"gry_final_request\");\r\n        }\r\n        var xhr = cc.loader.getXMLHttpRequest();\r\n\r\n        xhr.onreadystatechange = function () {\r\n            //readyState属性，4 表示准备就绪状态， status属性 200 表示请求成功\r\n            if (xhr.readyState == 4) {\r\n                if (xhr.status >= 200 && xhr.status < 400) {\r\n                    log.info('Http.sendXHR: xhr.readyState is ready, url = {}', url);\r\n                    responseHandler && responseHandler(xhr.responseText, true);\r\n                } else {\r\n                    log.error('Http.sendXHR: xhr.requre failed! code = {}, url = {} ', xhr.status, url);\r\n                    responseHandler && responseHandler(xhr.responseText, false);\r\n                }\r\n\r\n            } else {\r\n                log.info('Http.sendXHR: xhr.readyState is not ready!');\r\n            }\r\n        };\r\n\r\n        //open最多有5个参数(method,url,async(是否异步),user,password)\r\n        xhr.open(\"GET\", url, true);\r\n        if (cc.sys.isNative) {\r\n            xhr.setRequestHeader(\"Accept-Encoding\", \"gzip,deflate\");\r\n            xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');\r\n        }\r\n\r\n        // note: In Internet Explorer, the timeout property may be set only after calling the open()\r\n        // method and before calling the send() method.\r\n        xhr.timeout = 3000;// 5 seconds for timeout\r\n        xhr.send();\r\n    },\r\n\r\n    operType: {\r\n        testcard: { type: 'testcard', time: 0 },//贵宾卡测试接口\r\n        itemUse: { type: 'itemUse', time: 0 },  //背包中物品使用\r\n        checkin: { type: 'checkin', time: 0 }, //签到\r\n        shop: { type: 'shop', time: 0 }, //shop\r\n        itemBuy: { type: 'itemBuy', time: 0 },//道具购买\r\n        itemSend: { type: 'itemSend', time: 0 },//道具赠送\r\n        mailGA: { type: 'mailGA', time: 0 },//邮件\r\n        bless: { type: 'bless', time: 0 },//祈福\r\n        search: { type: 'search', time: 0 },//friend\r\n        role: { type: 'roleCG', time: 0 },//个人信息\r\n        mailLS: { type: 'mailLS', time: 0 },//邮件列表\r\n        mailCG: { type: 'mailCG', time: 0 },//邮件状态\r\n        red: { type: 'red', time: 0 },//红点\r\n        notice: { type: 'notice', time: 0 },//跑马灯\r\n        shopdh: { type: 'shopdh', time: 0 },//积分兑换\r\n        itemSell:{ type: 'itemSell', time: 0 },//积分兑换\r\n        share:{ type: 'share', time: 0 },//通知服务器分享成功\r\n        shareBonus:{ type: 'shareBonus', time: 0 },//领取分享奖励\r\n        midas:{ type:'midas', time: 0 }, //微信支付 米大师\r\n    },\r\n\r\n    //玩家数据变化\r\n    playerDataType: {\r\n        gold: 'gold',\r\n        items: 'items',\r\n        dmd: 'diamond',\r\n        vExp: 'vipExp',\r\n        vLvl: 'vipLevel',\r\n        cpn: 'coupon',\r\n        shopbuy: 'buyItems',\r\n    },\r\n    tryMax: 3,//如果同步数据出现问题尝试同步的最大次数\r\n    tryCount: 0,//当前尝试的次数\r\n    httpDelay: 500,//同一个http两次间隔时间 如果超过这个间隔可以请求，如果小于该间隔不进行处理\r\n\r\n\r\n    //player 数据同步\r\n    httpSync: function (callBack,self) {\r\n        let sendData = {\r\n            // roleId: PlayerData.uid,\r\n            // token: PlayerData.token\r\n        };\r\n        Http.sendRequest(Global.MsgMacroHttp.sync, sendData, function (status, data) {\r\n            if (status) {\r\n                // PlayerData.updateData(data);\r\n                game.EventManager.dispatchEvent(Global.eventName.redPointStatus);\r\n                this.tryCount = 0;\r\n                if (!!self) {\r\n                    callBack && callBack.call(self);\r\n                }\r\n\r\n            } else {\r\n                if (this.tryCount < this.tryMax) {\r\n                    this.httpSync();\r\n                    this.tryCount++;\r\n                }\r\n\r\n            }\r\n\r\n        }.bind(this));\r\n    },\r\n\r\n    httpJoinRoom: function (callback, roomType, gameType = 'buyu') {\r\n        if (Global.isEnterFish) {\r\n            return;\r\n        }\r\n        if (CodeType === Global.CodeType.Fish) {\r\n            gameType = 'buyu';\r\n        } else {\r\n            gameType = 'fish';\r\n        }\r\n        Global.isEnterFish = true;\r\n        let sendData = { game: gameType, type: roomType }\r\n        Http.sendRequest('room', sendData, function (status, data) {\r\n            if (status) {\r\n                if (!!data.data && !!data.data.ip) {\r\n                    // PlayerData.sip = data.data.ip;\r\n                    // PlayerData.sport = data.data.port;\r\n                    if (!!callback) {\r\n                        callback();\r\n                    }\r\n                } else {\r\n                    Alert.show(il8n.t('room_fail'), null, true);\r\n                    Global.isEnterFish = false;\r\n                }\r\n\r\n            }\r\n        }.bind(this))\r\n\r\n    },\r\n\r\n    //快速登录\r\n    httpQuick: function (url, callBack) {\r\n        Http.sendXHR(url, (data, status) => {\r\n            if (status) {\r\n                let obj = JSON.parse(data);\r\n                // PlayerData.reset();\r\n                // PlayerData.updateData(obj);\r\n                if (callBack) {\r\n                    callBack(obj);\r\n                }\r\n                // require('LoginHelper').updateLoginTime(PlayerData.userId);;\r\n                // require('RedPointHelper').init();\r\n                // require('FuncHelper').initFunMask(obj.data.fmask);\r\n                \r\n            } else {\r\n                Alert.show(il8n.t('net_status'), null, null);\r\n                cc.log('网络出现问题了+++');\r\n            }\r\n\r\n        });\r\n    },\r\n    //验证码\r\n    httpCode: function(url,callBack) {\r\n        Http.sendXHR(url, (data, status) => {\r\n            if (status) {\r\n                let obj = JSON.parse(data);\r\n                if (callBack) {\r\n                    callBack(obj,status);\r\n                }\r\n            } else {\r\n                Alert.show(il8n.t('net_status'), null, null);\r\n            }\r\n\r\n        });\r\n    },\r\n\r\n    //http请求操作 短连接使用这个接口\r\n    //添加一个点击过快的回调接口，用于处理模块功能中的逻辑\r\n    httpOper: function (type, callBack, self, param,fcallBack) {\r\n        if (Date.now() - type.time < this.httpDelay) {\r\n            cc.log('http requset to first ：' + type.type);\r\n            if (!!self) {\r\n                fcallBack && fcallBack.call(self);\r\n            }\r\n            return;\r\n        }\r\n        if (type.type == 'broke') {\r\n            log.info(\"gry——请求发财金：\" + Date.now());\r\n        }\r\n        type.time = Date.now();\r\n        let data = {\r\n            oper: type.type,\r\n            // roleId: PlayerData.uid,\r\n            // token: PlayerData.token,\r\n            time : Math.floor(Date.now() + Global.standSunTime),\r\n        };\r\n        let jsonParam = null;\r\n        if (param) {\r\n            jsonParam = JSON.stringify(param);\r\n            let b64 = Base64.encode(jsonParam);\r\n            data.param = encodeURIComponent(b64);\r\n        }\r\n        let sign = this.gentoken(data,jsonParam);\r\n        data.sign = sign;\r\n        Http.sendRequest(Global.MsgMacroHttp.oper, data, function (success, ret) {\r\n            if (success) {\r\n                if (ret.status === 1) {\r\n                    if (ret.data) {\r\n                        if (type.type == 'shop') {\r\n                            let rewardString = ret.data['bonus'].split('|');\r\n                            let rewardNum = rewardString[2];\r\n                            game.EventManager.dispatchEvent(Global.eventName.aftershop, { rewardNum: rewardNum });\r\n                        }\r\n                        this.updatePlayerData(ret.data[type.type], type.type)\r\n                    }\r\n                    if (!!self) {\r\n                        callBack && callBack.call(self, ret);\r\n                    }\r\n                } else {\r\n                    if (ret.code < 2000) {\r\n                        Global.CommomUICtl.initCreateTips({ tip: il8n.t('code_' + ret.code), time: 2 });\r\n                    } else {\r\n                        if (!!self) {\r\n                            callBack && callBack.call(self, ret);\r\n                        }\r\n                    }\r\n\r\n                }\r\n            }\r\n            else {\r\n                log.error(type.type + '--请求失败 ！！！');\r\n                Alert.show('网络出现问题，请检查网络！', null, true);\r\n            }\r\n        }.bind(this));\r\n    },\r\n\r\n    gentoken: function(data,param){\r\n        let sign = '';\r\n        sign += data.oper;\r\n        sign += data.roleId;\r\n        sign += data.token;\r\n        sign += data.time;\r\n        if (!!param) {\r\n            sign += param;\r\n        }\r\n        sign += '57$$8709pKjF5*$w';\r\n        return md5(sign);\r\n        \r\n    },\r\n\r\n    updatePlayerData: function (data, type) {\r\n        if (!!data) {\r\n            for (let key in data) {\r\n                if (key === 'items') {\r\n                    let items = JSON.parse(data[key]);\r\n                    // PlayerData.updateBagItemDataByID(items);\r\n                } else {\r\n                    // PlayerData[this.playerDataType[key]] = data[key];\r\n                    //vip 升级更新发财金的领取次数\r\n                    if (this.playerDataType[key] == 'vipLevel') {\r\n                        // PlayerData.getTheFacaijinTimes(PlayerData.vipLevel);\r\n                        // log.info(\"vip升级更新玩家的发财金领取次数，玩家当前vip：\" + PlayerData.vipLevel);\r\n                    }\r\n                }\r\n            }\r\n            game.EventManager.dispatchEvent(Global.eventName.refreshHall);\r\n            if (type != 'broken') {\r\n                if (data.gold > 0) {\r\n                    log.info(\"http update facaijin\");\r\n                    game.EventManager.dispatchEvent(Global.eventName.cancleFacaijin); //破产期间发财金变化，取消破产状态\r\n                }\r\n                if (type != 'search') {\r\n                    setTimeout(() => {\r\n                        game.EventManager.dispatchEvent(Global.eventName.refreshMainSceneRes, {});\r\n                    }, 200);\r\n                }\r\n\r\n            }\r\n        }\r\n    },\r\n\r\n}\r\n\r\nmodule.exports = Http;\r\n"]}