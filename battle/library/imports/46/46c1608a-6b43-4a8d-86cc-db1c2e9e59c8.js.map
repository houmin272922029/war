{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\script\\framework\\utils/assets\\script\\framework\\utils\\ErrorRecord.js"],"names":["ErrorRecord","_catch","_init","_url","init","_data","cc","sys","localStorage","getItem","isValid","JSON","parse","report","data","stringify","send","setItem","xhr","loader","getXMLHttpRequest","url","onreadystatechange","readyState","status","log","error","open","isNative","setRequestHeader","timeout","__handle","window","__errorHandler","arguments","isBrowser","onerror"],"mappings":";;;;;;AACA,IAAIA,cAAc;AACdC,YAAQ,EADM;AAEdC,WAAO,KAFO;AAGdC,UAAM,uCAHQ;AAId;AACAC,QALc,kBAKP;AACH,YAAI,CAAC,KAAKF,KAAV,EAAiB;AACb,gBAAIG,QAAQC,GAAGC,GAAH,CAAOC,YAAP,CAAoBC,OAApB,CAA4B,aAA5B,CAAZ;AACA,gBAAI,CAACH,GAAGI,OAAH,CAAWL,KAAX,CAAD,IAAsBA,SAAS,EAAnC,EAAuC;AACnCA,wBAAQ,EAAR;AACH,aAFD,MAEO;AACHA,wBAAQM,KAAKC,KAAL,CAAWP,KAAX,CAAR;AACH;AACD,iBAAKJ,MAAL,GAAcI,KAAd;AACH;AACD,aAAKH,KAAL,GAAa,IAAb;AACH,KAhBa;AAiBdW,UAjBc,kBAiBPC,IAjBO,EAiBD;AACT,aAAKV,IAAL;AACA,YAAIC,QAAQM,KAAKI,SAAL,CAAeD,IAAf,CAAZ;AACA,YAAI,CAAC,KAAKb,MAAL,CAAYI,KAAZ,CAAL,EAAyB;AACrB,iBAAKJ,MAAL,CAAYI,KAAZ,IAAqB,CAArB;AACA;AACA;AACA,iBAAKW,IAAL,CAAUX,KAAV;;AAEAC,eAAGC,GAAH,CAAOC,YAAP,CAAoBS,OAApB,CAA4B,aAA5B,EAA2CN,KAAKI,SAAL,CAAe,KAAKd,MAApB,CAA3C;AACH;AACJ,KA5Ba;AA8Bde,QA9Bc,gBA8BTF,IA9BS,EA8BH;AACP,YAAII,MAAMZ,GAAGa,MAAH,CAAUC,iBAAV,EAAV;AACA,YAAIC,MAAM,KAAKlB,IAAf;AACAe,YAAII,kBAAJ,GAAyB,YAAY;AACjC;AACA,gBAAIJ,IAAIK,UAAJ,IAAkB,CAAtB,EAAyB;AACrB,oBAAIL,IAAIM,MAAJ,IAAc,GAAd,IAAqBN,IAAIM,MAAJ,GAAa,GAAtC,EAA2C;AACvC;AACH,iBAFD,MAEO;AACHC,wBAAIC,KAAJ,CAAU,2CAAV,EAAuDR,IAAIM,MAA3D,EAAmEH,GAAnE;AACH;AAEJ,aAPD,MAOO;AACH;AACH;AACJ,SAZD;AAaAH,YAAIS,IAAJ,CAAS,MAAT,EAAiBN,GAAjB,EAAsB,IAAtB;AACA,YAAIf,GAAGC,GAAH,CAAOqB,QAAX,EAAqB;AACjBV,gBAAIW,gBAAJ,CAAqB,iBAArB,EAAwC,cAAxC;AACAX,gBAAIW,gBAAJ,CAAqB,cAArB,EAAqC,iCAArC;AACH;AACDX,YAAIY,OAAJ,GAAc,IAAd,CArBO,CAqBY;AACnBZ,YAAIF,IAAJ,CAASF,IAAT;AACH;AArDa,CAAlB;;AAwDA,IAAIR,GAAGC,GAAH,CAAOqB,QAAX,EAAqB;AACjB,QAAIG,WAAWC,OAAOC,cAAtB;AACAD,WAAOC,cAAP,GAAwB,YAAY;AAChCjC,oBAAYa,MAAZ,CAAmBqB,SAAnB;AACA,YAAIH,QAAJ,EAAc;AACVA,qBAASG,SAAT;AACH;AACJ,KALD;AAOH,CATD,MASO,IAAI5B,GAAGC,GAAH,CAAO4B,SAAX,EAAsB;AACzB,QAAIJ,UAAWC,OAAOI,OAAtB;AACAJ,WAAOI,OAAP,GAAiB,YAAY;AACzBpC,oBAAYa,MAAZ,CAAmBqB,SAAnB;AACA,YAAIH,OAAJ,EAAc;AACVA,oBAASG,SAAT;AACH;AACJ,KALD;AAMH","file":"ErrorRecord.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\framework\\utils","sourcesContent":["\r\nlet ErrorRecord = {\r\n    _catch: {},\r\n    _init: false,\r\n    _url: 'http://140.143.209.62:8099/game/error',\r\n    // _url: 'http://192.168.16.87:8098/game/error',\r\n    init() {\r\n        if (!this._init) {\r\n            let _data = cc.sys.localStorage.getItem('ErrorRecord');\r\n            if (!cc.isValid(_data) || _data == '') {\r\n                _data = {};\r\n            } else {\r\n                _data = JSON.parse(_data);\r\n            }\r\n            this._catch = _data;\r\n        }\r\n        this._init = true;\r\n    },\r\n    report(data) {\r\n        this.init();\r\n        let _data = JSON.stringify(data);\r\n        if (!this._catch[_data]) {\r\n            this._catch[_data] = 1;\r\n            // let http = require('HttpHelper');\r\n            // http.httpOper(http.operType.error, null, null, _data);\r\n            this.send(_data);\r\n\r\n            cc.sys.localStorage.setItem('ErrorRecord', JSON.stringify(this._catch));\r\n        }\r\n    },\r\n\r\n    send(data) {\r\n        let xhr = cc.loader.getXMLHttpRequest();\r\n        let url = this._url;\r\n        xhr.onreadystatechange = function () {\r\n            //readyState属性，4 表示准备就绪状态， status属性 200 表示请求成功\r\n            if (xhr.readyState == 4) {\r\n                if (xhr.status >= 200 && xhr.status < 400) {\r\n                    // log.info('Http.sendXHR: xhr.readyState is ready, url = {}', url);\r\n                } else {\r\n                    log.error('error report failed! code = {}, url = {} ', xhr.status, url);\r\n                }\r\n\r\n            } else {\r\n                // log.info('Http.sendXHR: xhr.readyState is not ready!');\r\n            }\r\n        };\r\n        xhr.open(\"POST\", url, true);\r\n        if (cc.sys.isNative) {\r\n            xhr.setRequestHeader(\"Accept-Encoding\", \"gzip,deflate\");\r\n            xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');\r\n        }\r\n        xhr.timeout = 5000;// 5 seconds for timeout\r\n        xhr.send(data);\r\n    }\r\n}\r\n\r\nif (cc.sys.isNative) {\r\n    let __handle = window.__errorHandler;\r\n    window.__errorHandler = function () {\r\n        ErrorRecord.report(arguments);\r\n        if (__handle) {\r\n            __handle(arguments);\r\n        }\r\n    }\r\n\r\n} else if (cc.sys.isBrowser) {\r\n    let __handle = window.onerror;\r\n    window.onerror = function () {\r\n        ErrorRecord.report(arguments);\r\n        if (__handle) {\r\n            __handle(arguments);\r\n        }\r\n    }\r\n}"]}